# 0x01 漏洞解析
在常规的支付流程中，系统会对支付金额进行严格校验，以确保交易的合理性与安全性。然而，当支付系统在设计或编码过程中存在缺陷时，就可能出现允许用户将总价修改为负数并成功支付的情况。例如，某些系统在处理支付请求时，未对前端传递过来的价格参数进行有效验证，或者在计算总价时，没有考虑到数量或价格为负数的异常情况。黑客一旦发现这类漏洞，便可以通过篡改支付请求中的数据，将商品总价改为负数。这样一来，不仅能免费获取商品，甚至可能让商家倒贴钱，给商家带来巨大的经济损失。

下图为乌云找到的漏洞。

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755432096439-b3736330-b983-4c92-bc6c-ffa714241ca9.png)

# 0x02 漏洞环境
针对此漏洞，在[好靶场](http://www.loveli.com.cn:12531/)平台有搭建自创的同类型漏洞

靶场连接：[http://www.loveli.com.cn:12531/](http://www.loveli.com.cn:12531/)

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755432902103-36918181-b266-45ef-8a6c-f6e1cd9262f9.png)

# 0x03 漏洞复现
![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755246207904-e9b6d84b-c365-452f-b87b-a82583fdacc0.png)

点击购买物品，然后确认购买

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755246232588-cda61f66-c610-4fb4-a739-63935c512ee0.png)

提示余额不足

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755246247194-e159cd9b-2a7d-4745-aad7-b70d21b184f9.png)

获取数据包

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755246302490-f5c3ee37-2609-475e-8652-cb30e70d0f05.png)

修改为负数，发现钱包金额反向增长

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755246316426-45679359-3e01-4e95-a613-4ec6933e1dc9.png)

修改为负数-999，出现flag

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755246345106-2cd78c9e-ccc3-4ed2-93f4-9eabed8c0a88.png)



## 
# 0x04 漏洞修复方法
前端与后端双重校验：前端需对用户输入的价格、数量等参数进行初步校验，限制参数的合理范围（如价格不能为负数、数量不能小于 1），但不能仅依赖前端校验。关键在于后端，在接收支付请求后，必须重新计算商品总价，将后端数据库中存储的商品单价与用户选择的数量进行相乘，得到准确的总价，再与前端传递的总价参数进行比对，若不一致则直接拒绝支付请求。





