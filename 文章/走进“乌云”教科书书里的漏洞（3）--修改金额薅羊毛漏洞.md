# 0x01 漏洞解析
<font style="color:rgba(0, 0, 0, 0.85) !important;">修改金额薅羊毛漏洞是电商、支付类系统中常见的业务逻辑漏洞，核心成因是系统对订单金额、支付金额等关键数据的校验机制缺失或不完整，导致攻击者可通过篡改数据绕过正常定价规则，以远低于正常价格甚至零成本获取商品或服务。</font>

<font style="color:rgba(0, 0, 0, 0.85) !important;">具体表现为：</font>

+ **<font style="color:rgb(0, 0, 0) !important;">数据篡改路径</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：攻击者通常通过抓包工具（如 Fiddler、Burp Suite）拦截前端向后端发送的订单请求、支付请求，直接修改请求中的金额参数（如将 “totalAmount=999” 改为 “totalAmount=9.9” 或 “totalAmount=0”）。</font>
+ **<font style="color:rgb(0, 0, 0) !important;">校验缺失场景</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：系统仅在前端进行金额展示和简单校验（如限制输入框不能输入负数），但未在后端对金额的合理性进行二次验证；或后端未基于数据库中存储的商品原价、优惠规则重新计算订单总价，直接信任前端传递的金额参数。</font>

下图为乌云找到的漏洞。

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755434669264-1bea9e6a-7c20-4268-b77f-d8293ceb3a5a.png)

# 0x02 漏洞环境
针对此漏洞，在[好靶场](http://www.loveli.com.cn:12531/)平台有搭建自创的同类型漏洞

靶场连接：[http://www.loveli.com.cn:12531/](http://www.loveli.com.cn:12531/)

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755434728998-857bd7ef-4089-46a0-8cf8-6515fc90ce2c.png)

# 0x03 漏洞复现
访问靶场网址

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755244950858-94605a9f-f5bd-4c86-8534-559c4b72486e.png)

通过点击购买可以将物品添加到购物车中，点击结账会提示余额不足

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755245056767-e1d185d7-e111-4dae-b585-02f92ed45329.png)

 打开 Burp Suite、Fiddler 等抓包工具，确保代理设置正确（浏览器代理指向抓包工具端口，例：`127.0.0.1:8080`），拦截目标网站的 HTTP/HTTPS 请求。  

点击结账，并且获取数据包 修改请求包中的物品单价 图示修改为4元

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755245161356-e1a22c50-4cce-4928-ad8e-9d95ade70546.png)

通过此方式以极低的价格购买商品 获得此题flag

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755245256759-14e8180d-1a26-4628-a967-a9b9751b1f6f.png)

# 0x04 漏洞修复方法
前端与后端双重校验：前端需对用户输入的价格、数量等参数进行初步校验，限制参数的合理范围（如价格不能为负数、数量不能小于 1），但不能仅依赖前端校验。关键在于后端，在接收支付请求后，必须重新计算商品总价，将后端数据库中存储的商品单价与用户选择的数量进行相乘，得到准确的总价，再与前端传递的总价参数进行比对，若不一致则直接拒绝支付请求。



