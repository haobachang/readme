# 0x01 漏洞解析
<font style="color:rgba(0, 0, 0, 0.85) !important;">文件上传漏洞是 Web 应用中常见的安全风险，当应用程序对用户上传的文件缺乏严格验证时，攻击者可能上传恶意文件（如 HTML、PHP、JavaScript 等），进而执行非法操作。</font>

<font style="color:rgba(0, 0, 0, 0.85) !important;">在 HTML 相关场景中，主要表现为：</font>

+ <font style="color:rgba(0, 0, 0, 0.85) !important;">允许上传 HTML 文件，攻击者可构造包含恶意 JavaScript 代码的 HTML 文件</font>
+ <font style="color:rgba(0, 0, 0, 0.85) !important;">上传的 HTML 文件能被服务器解析并执行其中的脚本</font>
+ <font style="color:rgba(0, 0, 0, 0.85) !important;">缺乏文件类型验证，导致本应限制为图片的上传功能被用于上传 HTML 文件</font>

<font style="color:rgba(0, 0, 0, 0.85) !important;">危害包括：</font>

+ <font style="color:rgba(0, 0, 0, 0.85) !important;">存储型 XSS 攻击：其他用户访问恶意 HTML 文件时，脚本会在其浏览器中执行</font>
+ <font style="color:rgba(0, 0, 0, 0.85) !important;">钓鱼攻击：伪造与网站相似的页面窃取用户信息</font>
+ <font style="color:rgba(0, 0, 0, 0.85) !important;">服务器端攻击：结合其他漏洞时可能导致服务器被入侵</font>

下图为乌云找到的漏洞

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755436343186-6fa11c10-8dd4-4c37-9035-db5b257711be.png)

# 0x02 漏洞环境
针对此漏洞，在[好靶场](http://www.loveli.com.cn:12531/)平台有搭建自创的同类型漏洞

靶场连接：[http://www.loveli.com.cn:12531/](http://www.loveli.com.cn:12531/)

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755436045251-30210c9a-51b2-499e-afe2-11a68a64650b.png)

# 0x03 漏洞复现
问靶场链接之后，是一个图片上传的功能

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755244699113-b7606e39-a66f-4d97-a48b-f48700712d91.png)

尝试上传php等文件

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755244826676-8c98bb0c-2ce1-413b-b61d-4239d53547eb.png)

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755244827109-ced0fcdd-f087-40d1-b87f-f84eca540b79.png)

此时尝试上传一个html，上传成功

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755244953186-784af0bf-0f35-4b36-ae66-2663d656ab8a.png)

访问上传的链接，可以获取flag

![](https://cdn.nlark.com/yuque/0/2025/png/50745682/1755245032201-3336eb97-fba3-44e8-a7b6-e85cfd018a2a.png)

# 0x04 漏洞修复方法
**<font style="color:rgb(0, 0, 0) !important;">前端验证（辅助措施）</font>**

    - <font style="color:rgba(0, 0, 0, 0.85) !important;">使用</font>`<font style="color:rgb(0, 0, 0);">accept</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">属性限制可选文件类型</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">JavaScript 验证文件扩展名和大小</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">提供清晰的文件格式和大小提示</font>

**<font style="color:rgb(0, 0, 0) !important;">后端必须实现的安全验证（核心）</font>**

    - <font style="color:rgba(0, 0, 0, 0.85) !important;">验证文件 MIME 类型，不依赖文件扩展名</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">检查文件内容，确认文件真实类型（如检查图片文件的魔术数字）</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">将上传文件存储在 Web 根目录之外，通过脚本间接访问</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">重命名上传文件，避免使用用户提供的文件名</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">设置严格的文件大小限制</font>
    - <font style="color:rgba(0, 0, 0, 0.85) !important;">禁止执行上传目录中的任何文件</font>





