# 0x01 漏洞解析
<font style="color:rgba(0, 0, 0, 0.85) !important;">越权获取信息漏洞是 Web 应用中常见的权限控制缺陷，指攻击者通过技术手段绕过系统的权限验证机制，非法访问或获取本不应属于自己权限范围内的敏感信息。该漏洞的核心成因是系统未对用户的操作权限进行严格校验，或权限校验逻辑存在设计缺陷。</font>

<font style="color:rgba(0, 0, 0, 0.85) !important;">具体表现与危害：</font>

+ **<font style="color:rgb(0, 0, 0) !important;">水平越权</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：同一权限级别下的不同用户之间发生的越权访问，例如用户 A 能通过修改请求中的用户 ID 参数，查看到用户 B 的个人信息、订单记录等。</font>
+ **<font style="color:rgb(0, 0, 0) !important;">垂直越权</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：低权限用户获取高权限用户的信息或操作权限，例如普通用户通过构造特殊请求，访问管理员才能查看的用户数据库、后台统计数据等。</font>
+ **<font style="color:rgb(0, 0, 0) !important;">常见攻击路径</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：攻击者通过修改 URL 中的 ID 参数（如</font>`<font style="color:rgb(0, 0, 0);">userinfo?id=123</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">改为</font>`<font style="color:rgb(0, 0, 0);">userinfo?id=124</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">）、篡改请求头中的身份标识、重复使用已失效的会话令牌（Session ID）等方式，绕过权限校验逻辑。</font>
+ **<font style="color:rgb(0, 0, 0) !important;">危害后果</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：导致用户隐私信息（如手机号、地址、身份证号）、商业敏感数据（如客户列表、交易记录）、系统配置信息等被非法获取，引发数据泄露事件，违反《网络安全法》《个人信息保护法》等法律法规，同时对用户权益和企业信誉造成严重损害。</font>

下图为乌云找到的漏洞。

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755435894789-86262abc-bbbc-48eb-8592-a36bd6d7084f.png)

# 0x02 漏洞环境
针对此漏洞，在[好靶场](http://www.loveli.com.cn:12531/)平台有搭建自创的同类型漏洞

靶场连接：[http://www.loveli.com.cn:12531/](http://www.loveli.com.cn:12531/)

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755435732364-b0d8dc20-00e4-41d9-8260-4efd94b28664.png)

# 0x03 漏洞复现
访问靶场

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755245967103-c6ddf6ba-94d3-4054-a044-4bc4dc598e5b.png)

利用F12查看网络请求信息 发现用户信息通过/api/user/profile?id=1 获取 

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755246085225-2bb8f501-d520-4cf4-a0c1-4f3e55ec714d.png)

打开 Burp Suite、Fiddler 等抓包工具，确保代理设置正确（浏览器代理指向抓包工具端口，例：`127.0.0.1:8080`），拦截目标网站的 HTTP/HTTPS 请求。  

重放此请求包 尝试修改id 查看能够获取到其他用户信息

修改id为3获取到flag

![](https://cdn.nlark.com/yuque/0/2025/png/8420228/1755246244068-2f95709b-88f4-4ddb-b47a-3fa71d8e4a52.png)

# 0x04 漏洞修复方法
1. **<font style="color:rgb(0, 0, 0) !important;">实现严格的权限校验机制</font>**
    - **<font style="color:rgb(0, 0, 0) !important;">后端强制权限校验</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：所有涉及信息查询的接口（如用户信息、订单详情、后台数据）必须在后端进行权限校验，不能仅依赖前端隐藏按钮或页面跳转限制。校验逻辑应包含："当前登录用户是否有权访问该资源"、"访问的资源是否属于当前用户"。</font>
    - **<font style="color:rgb(0, 0, 0) !important;">基于角色的访问控制（RBAC）</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：采用 RBAC 模型管理权限，明确不同角色（如普通用户、VIP 用户、管理员）的权限范围，例如普通用户只能访问自己的信息，管理员可访问全量用户列表但需二次验证。</font>
    - **<font style="color:rgb(0, 0, 0) !important;">资源与用户强绑定</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：查询资源时，后端必须将 "当前登录用户 ID" 与 "待查询资源所属用户 ID" 进行比对，一致才返回数据。例如查询订单时，SQL 语句应强制包含</font>`<font style="color:rgb(0, 0, 0);">where user_id = 当前登录用户ID</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">，而非仅依赖前端传递的</font>`<font style="color:rgb(0, 0, 0);">order_id</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">。</font>
2. **<font style="color:rgb(0, 0, 0) !important;">规范参数传递与校验</font>**
    - **<font style="color:rgb(0, 0, 0) !important;">避免直接使用用户可控参数作为查询条件</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：对于敏感资源（如用户信息、订单），禁止将前端传递的 ID 参数（如</font>`<font style="color:rgb(0, 0, 0);">user_id</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">、</font>`<font style="color:rgb(0, 0, 0);">order_id</font>`<font style="color:rgba(0, 0, 0, 0.85) !important;">）直接作为数据库查询条件，应通过当前登录用户的会话信息（如 Session、Token）获取用户唯一标识，再拼接查询条件。</font>
    - **<font style="color:rgb(0, 0, 0) !important;">参数加密与脱敏</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：若必须传递资源 ID，应对 ID 进行加密处理（如使用非对称加密、哈希加盐），防止攻击者猜测或篡改 ID。同时，返回数据时对敏感字段（如手机号显示为 138****5678）进行脱敏，降低信息泄露风险。</font>
    - **<font style="color:rgb(0, 0, 0) !important;">严格的输入验证</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：对所有用户输入的参数（尤其是 ID、标识类参数）进行格式校验和范围校验，例如用户 ID 必须为正整数且在合理范围内，不符合规则则直接拒绝请求。</font>
3. **<font style="color:rgb(0, 0, 0) !important;">强化会话与身份管理</font>**
    - **<font style="color:rgb(0, 0, 0) !important;">安全的会话机制</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：使用随机生成的高强度会话令牌（Session ID），设置合理的过期时间（如 30 分钟无操作自动失效），并在用户登出时立即销毁会话。避免在 URL 中传递会话标识，防止被拦截或记录。</font>
    - **<font style="color:rgb(0, 0, 0) !important;">Token 权限控制</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：采用 JWT 等 Token 机制时，需在 Token 中包含用户角色、权限范围等信息，并在服务端验证 Token 的有效性（如是否过期、是否被篡改）。对于高权限操作（如查看敏感数据），可要求用户重新验证身份（如输入密码、验证码）。</font>
    - **<font style="color:rgb(0, 0, 0) !important;">防止会话固定攻击</font>**<font style="color:rgba(0, 0, 0, 0.85) !important;">：用户登录成功后，应立即刷新会话令牌，避免攻击者利用未登录状态下的会话令牌诱导用户登录，进而获取权限。</font>





